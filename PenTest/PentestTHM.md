# ETH
===============================================================================
# Passive Reconnaissance
```
DNS

Lookup WHOIS record	whois tryhackme.com
Lookup DNS A records	nslookup -type=A tryhackme.com
Lookup DNS MX records at DNS server	nslookup -type=MX tryhackme.com 1.1.1.1
Lookup DNS TXT records	nslookup -type=TXT tryhackme.com
Lookup DNS A records	dig tryhackme.com A
Lookup DNS MX records at DNS server	dig @1.1.1.1 tryhackme.com MX
Lookup DNS TXT records	dig tryhackme.com TXT

DNSDumpster
shodan.io
```
===============================================================================
# Active Reconnaissance
```
FoxyProxy lets you quickly change the proxy server you are using to access the target website. This browser extension is convenient when you are using a tool such as Burp Suite or if you need to switch proxy servers regularly. You can get FoxyProxy for Firefox from here.
User-Agent Switcher and Manager gives you the ability to pretend to be accessing the webpage from a different operating system or different web browser. In other words, you can pretend to be browsing a site using an iPhone when in fact, you are accessing it from Mozilla Firefox. You can download User-Agent Switcher and Manager for Firefox here.
Wappalyzer provides insights about the technologies used on the visited websites. Such extension is handy, primarily when you collect all this information while browsing the website like any other user. A screenshot of Wappalyzer is shown below. You can find Wappalyzer for Firefox here.


telnet banner grabbing:
telnet <ip> <port>			# or nc (netcat)
GET / HTTP/1.1				# or GET /<page>.html
host: example (any name)		# enter twice


netcat

nc -lvnp 1234				# our machine
-l	Listen mode
-p	Specify the Port number
-n	Numeric only; no resolution of hostnames via DNS
-v	Verbose output (optional, yet useful to discover any bugs)
-vv	Very Verbose (optional)
-k	Keep listening after client disconnects


nc 10.10.32.147 1234			# target machine

```

===============================================================================
# Nmap Live Host Discovery

```
-----------------------
ARP scan: This scan uses ARP requests to discover live hosts
ICMP scan: This scan uses ICMP requests to identify live hosts
TCP/UDP ping scan: This scan sends packets to TCP ports and UDP ports to determine live hosts.
Using Reverse-DNS Lookup

When a privileged user tries to scan targets on a local network (Ethernet), Nmap uses ARP requests. A privileged user is root or a user who belongs to sudoers and can run sudo.
When a privileged user tries to scan targets outside the local network, Nmap uses ICMP echo requests, TCP ACK (Acknowledge) to port 80, TCP SYN (Synchronize) to port 443, and ICMP timestamp request.
When an unprivileged user tries to scan targets outside the local network, Nmap resorts to a TCP 3-way handshake by sending SYN packets to ports 80 and 443.

-----------------------
# add scan targets:
list: MACHINE_IP scanme.nmap.org example.com will scan 3 IP addresses.
range: 10.11.12.15-20 will scan 6 IP addresses: 10.11.12.15, 10.11.12.16,… and 10.11.12.20.
subnet: MACHINE_IP/30 will scan 4 IP addresses.
file: nmap -iL list_of_hosts.txt


nmap -sL TARGETS			# list the scan targets - use -n to avoid reverse-DNS resolution - useful for scripting
					# giving the list without scanning them

-----------------------
# Nmap Host Discovery Using ARP

nmap -sn TARGETS			# host discovery only, disable scan ports. (ICMP)
nmap -PR -sn TARGETS			# only to perform an ARP scan without port-scanning (ONLY on same subnet)


-----------------------
# Nmap Host Discovery Using ICMP

ICMP Echo Request (-PE -sn <<no port scan>>)
Sends ICMP Echo Requests and waits for replies.
Example: sudo nmap -PE -sn MACHINE_IP/24
Some devices may block ICMP, so not all live hosts will respond.

ICMP Timestamp Request (-PP -sn <<no port scan>>)
Uses ICMP Timestamp Requests instead of Echo Requests.
Example: sudo nmap -PP -sn MACHINE_IP/24
Can bypass some firewalls that block normal ICMP pings.

ICMP Address Mask Request (-PM -sn <<no port scan>>)
Uses ICMP Address Mask queries.
Example: sudo nmap -PM -sn MACHINE_IP/24
Often blocked by firewalls, making it unreliable.

-----------------------
# Nmap Host Discovery Using TCP and UDP

# still using -sn to say disable port scanning and perform only host discovery 

sudo nmap -PS 80 -sn MACHINE_IP/24	# SYN scan, SYN/ACK (online), RST (off - block)
sudo nmap -PA 80 -sn MACHINE_IP/24	# ACK scan, RST (online)
sudo nmap -PU -sn MACHINE_IP/24		# UDP scan


Alternative:
masscan MACHINE_IP/24 -p443
masscan MACHINE_IP/24 -p80,443
masscan MACHINE_IP/24 -p22-25
masscan MACHINE_IP/24 ‐‐top-ports 100

-----------------------
Using Reverse-DNS Lookup

# by default use reverse-DNS 		# disable by -n
# -R to query the DNS server even for offline hosts
# --dns-servers DNS_SERVER		# specific server

```

===============================================================================
# Nmap Basic Port Scans
```
-----------------------
Open: indicates that a service is listening on the specified port.
Closed: indicates that no service is listening on the specified port, although the port is accessible. By accessible, we mean that it is reachable and is not blocked by a firewall or other security appliances/programs.
Filtered: means that Nmap cannot determine if the port is open or closed because the port is not accessible. This state is usually due to a firewall preventing Nmap from reaching that port. Nmap’s packets may be blocked from reaching the port; alternatively, the responses are blocked from reaching Nmap’s host.
Unfiltered: means that Nmap cannot determine if the port is open or closed, although the port is accessible. This state is encountered when using an ACK scan -sA.
Open|Filtered: This means that Nmap cannot determine whether the port is open or filtered.
Closed|Filtered: This means that Nmap cannot decide whether a port is closed or filtered.

-----------------------
TCP Connect Scan
nmap -sT 10.10.49.251			# Port scan by establishing a full TCP connection
					# SYN, SYN/ACK, ACK
-----------------------
TCP SYN Scan
nmap -sS 10.10.49.251			# not establishing the connection, (best)
					# SYN, SYN/ACK, RST
-----------------------
UDP Scan
nmap -sU 10.10.49.251

-----------------------
-p-					# all ports
-p1-1023				# scan ports 1 to 1023
-F					# 100 most common ports
-r					# scan ports in consecutive order
-T<0-5>					# -T0 being the slowest and T5 the fastest
--max-rate 50				# rate <= 50, packets/sec to send
--min-rate 15				# rate >= 15, packets/sec to send
--min-parallelism 100			# at least 100 probes in parallel
```
===============================================================================

# Nmap Advanced Port Scans 
```
-----------------------
TCP Null Scan, FIN Scan, and Xmas Scan

Null Scan (-sN), Sends a TCP packet with no flags set.
(-sF), Sends a TCP packet with only the FIN flag.
(-sX), Sends a TCP packet with FIN, PSH, and URG flags

If the port is open, there is no response.
If the port is closed, the target sends an RST packet.
Result: Ports are identified as open|filtered (either open or blocked by a firewall).

Stateless firewalls may let these scans pass, Stateful firewalls will block these scans

-----------------------
TCP Maimon Scan, Uses FIN and ACK flags in TCP packets.
Most modern BSD-based systems always respond with RST, making the scan ineffective for detecting open ports.

-----------------------
TCP ACK, Window, and Custom Scan

ACK (-sA) and Window (-sW) scans help map firewall rules, not services.

1. TCP ACK Scan (-sA)
The target always responds with an RST, regardless of port state.
Purpose: Identifies which ports are not blocked by a firewall.

2. TCP Window Scan (-sW)
Works like an ACK scan but analyzes the TCP window field in RST packets returned.
Some systems return different values based on port state, revealing open ports.
Without a firewall: No extra information is gained.
Behind a firewall: Can differentiate closed vs. unfiltered ports, providing more insights than ACK scans.

3. Custom Scan (--scanflags), Allows users to set custom TCP flag combinations (e.g., SYN, RST, and FIN).

-----------------------
Spoofing and Decoys

1. Spoofing an IP Address
You can fake your IP address when scanning a target.
However, you won’t receive responses unless you can monitor the network traffic.

nmap -e NET_INTERFACE -Pn -S SPOOFED_IP 10.10.23.74
-e NET_INTERFACE: Specifies the network interface.
-Pn: Disables ping check.
-S SPOOFED_IP: Uses a fake source IP.

2. Spoofing a MAC Address
Possible only if the attacker and target are on the same local network (Ethernet or WiFi).
nmap --spoof-mac SPOOFED_MAC 10.10.23.74

3. Using Decoys to Hide Your IP between multiple different IPs
nmap -D 10.10.0.1,10.10.0.2,ME 10.10.23.74
nmap -D 10.10.0.1,10.10.0.2,RND,RND,ME 10.10.23.74		# (add random IPs)

-----------------------
Fragmented Packets

1. Packet Fragmentation (-f Option in Nmap)
Divides packets into smaller parts to evade firewalls and IDS.

nmap -sS -p80 -f 10.20.30.144

Breaks TCP headers into 8-byte fragments for stealth scanning.
Adding -ff (or -f -f) increases fragment size to 16 bytes.
Custom fragment size can be set using --mtu (must be a multiple of 8).

2. Increasing Packet Size for Stealth
Instead of fragmenting, you can make packets look normal by adding extra data.

nmap --data-length NUM 10.20.30.144				# NUM defines extra random bytes to make the scan less suspicious.


-----------------------
Idle/Zombie Scan
nmap -sI ZOMBIE_IP TARGET_IP					# using a zombie and compare its IP ID

-----------------------
Getting More Details

--reason				# explains how Nmap made its conclusion
-v					# verbose
-vv					# very verbose
-d					# debugging
-dd					# more details for debugging
```

===============================================================================
# Nmap Post Port Scans
```
-----------------------
Service Detection (-sV)
nmap -sV TARGET_IP
You can adjust scan intensity using --version-intensity LEVEL (0 = light, 9 = full).
--version-light → Level 2 (faster, less detail).
--version-all → Level 9 (more thorough, slower).

-----------------------
nmap -sS -O TARGET_IP				# OS
nmap -sS --traceroute TARGET_IP			# tracerout

-----------------------
Nmap Scripting Engine (NSE)

nmap -sS -sC TARGET_IP				# Default scripts
nmap -sS --script "SCRIPT-NAME" TARGET_IP	# Specific scripts
nmap --script "ftp*"				# Wildcard scripts

Category	Purpose
auth		Checks authentication methods
brute		Performs brute-force attacks
discovery	Finds network info like DNS records
exploit		Attempts exploits on vulnerabilities
malware		Detects backdoors/malware
safe		Runs harmless scans
vuln		Detects vulnerabilities
broadcast	Discover hosts by sending broadcast messages
dos		Detects servers vulnerable to Denial of Service (DoS)
external	Checks using a third-party service, such as Geoplugin and Virustotal
fuzzer		Launch fuzzing attacks
intrusive	Intrusive scripts such as brute-force attacks and exploitation
version		Retrieve service versions

-----------------------
Saving the Output

Normal (-oN)		Looks like the default screen output (not good for grep)
Grepable (-oG)		good for searching with grep	
XML (-oX)		good for importing into tools	
All (-oA)		Saving in all formats	
Script Kiddie (-oS)	Joke format (not useful)
```

===============================================================================
# Protocols and Servers
```
-----------------------
FTP
SYST – Shows the system type (e.g., UNIX).
PASV – Switches to passive mode.
TYPE A – ASCII mode for text files.
TYPE I – Binary mode for non-text files.
ls – Lists files in the directory.
get FILENAME – Downloads a file.

connect to ftp server using telnet:		# can run command, can't transfer files
telnet <IP> 21
USER <username>
PASS <password>

-----------------------
SMTP

Mail transfer:
Mail User Agent (MUA): The email client (e.g., Outlook, Gmail) that sends and receives emails.
Mail Submission Agent (MSA): Accepts outgoing emails, checks for errors, and forwards them.
Mail Transfer Agent (MTA): Routes the email from the sender’s server to the recipient’s server.
Mail Delivery Agent (MDA): Delivers the email to the recipient’s inbox.

SMTP works between the MUA and MSA to send emails and between MTAs to transfer emails.

-----------------------
POP3

POP3 and IMAP works between the MUA and MDA to retrieve emails from the mail server.

telnet 10.10.223.111 110  # Connect to the POP3 server on port 110  
USER frank                # Provide username  
PASS D2xc9CgD             # Provide password  
STAT                      # Check the number of messages  
LIST                      # List available messages  
RETR 1                    # Retrieve the first email  
QUIT                      # Close the connection  

-----------------------
IMAP

Keeps emails synchronized across multiple devices (e.g., phone, laptop).

telnet 10.10.223.111 143  # Connect to the IMAP server on port 143  
c1 LOGIN frank D2xc9CgD    # Authenticate with username and password  
c2 LIST "" "*"            # List mail folders  
c3 EXAMINE INBOX          # Check for new messages  
c4 LOGOUT                 # Close the connection  



```


===============================================================================
# Protocols and Servers 2
```
-----------------------
sudo tcpdump port 110 -A				# -A (ASCII)

-----------------------
Tools Used for MITM Attacks
Ettercap – Network security tool designed for MITM attacks.
Bettercap – Advanced tool for network attacks and traffic manipulation.

-----------------------
Password attack:

Hydra:
hydra -l username -P wordlist.txt server service
hydra -l lazie -P /usr/share/wordlists/rockyou.txt 10.10.197.186 imap

-l username → Specifies the username.
-P wordlist.txt → Specifies the password list.
server → The target's IP or hostname.
service → The target protocol (e.g., FTP, SSH).

other:
-s PORT → Specify a non-default port.
-V or -vV → Verbose mode (shows attempted combinations).
-t n → Number of parallel connections (e.g., -t 16 for 16 threads).
-d → Debugging mode for troubleshooting.
-L -> user list (users.txt)

```

===============================================================================
# Net Sec
``` 

```

